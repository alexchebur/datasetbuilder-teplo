<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–æ–≥–∞—â—ë–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–æ–≥–∞—â—ë–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞</span>
            <div class="d-flex">
                <span id="dataset-info" class="navbar-text text-light me-3">–ó–∞–ø–∏—Å–µ–π: 0</span>
                <a href="../index.html" class="btn btn-outline-light btn-sm">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–±–æ—Ä—â–∏–∫</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <h6 class="card-title text-muted">–ó–∞–ø–∏—Å–µ–π –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ</h6>
                        <h3 id="stat-records">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <h6 class="card-title text-muted">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π</h6>
                        <h3 id="stat-keys">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <h6 class="card-title text-muted">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</h6>
                        <h3 id="stat-chars">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <h6 class="card-title text-muted">–§–∞–π–ª</h6>
                        <h5 id="stat-filename" class="text-truncate">‚Äî</h5>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞</h5>
            </div>
            <div class="card-body">
                <div class="row align-items-end">
                    <div class="col-md-8">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ JSONL —Ñ–∞–π–ª —Å –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</label>
                        <input type="file" id="jsonl-upload" class="form-control" accept=".jsonl,.json">
                    </div>
                    <div class="col-md-4">
                        <button id="btn-load" class="btn btn-primary w-100">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç</button>
                    </div>
                </div>
                <div id="load-status" class="mt-2"></div>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ -->
        <div class="card mb-4" id="key-management-section" style="display: none;">
            <div class="card-header bg-warning">
                <h5 class="mb-0">üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π</h6>
                        <p class="text-muted small">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –í–°–ï–• –∑–∞–ø–∏—Å–µ–π</p>
                        <div id="keys-to-delete" class="d-flex flex-wrap gap-2"></div>
                    </div>
                    <div class="col-md-6">
                        <h6>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π</h6>
                        <p class="text-muted small">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á —Å –ø—É—Å—Ç—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º</p>
                        <div class="input-group mb-2">
                            <input type="text" id="new-key-name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞">
                            <select id="new-key-location" class="form-select" style="max-width: 200px;">
                                <option value="root">–ö–æ—Ä–Ω–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å</option>
                                <option value="plaintiff">plaintiff</option>
                                <option value="defendant">defendant</option>
                                <option value="initial_claims_sum">initial_claims_sum</option>
                                <option value="metadata">metadata</option>
                            </select>
                            <button id="btn-add-key" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="added-keys" class="d-flex flex-wrap gap-2"></div>
                    </div>
                </div>
                <div class="mt-3">
                    <button id="btn-apply-changes" class="btn btn-warning">üíæ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º</button>
                    <span id="apply-status" class="ms-3"></span>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∏ -->
        <div class="card mb-4" id="preview-section" style="display: none;">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∏</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å</label>
                        <select id="preview-select" class="form-select"></select>
                    </div>
                    <div class="col-md-8 text-end">
                        <button id="btn-save-record" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏</button>
                        <span id="save-status" class="ms-2"></span>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</h6>
                        <div id="preview-metadata" class="preview-box"></div>
                    </div>
                    <div class="col-md-6">
                        <h6>üìÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)</h6>
                        <div id="preview-content" class="preview-box"></div>
                    </div>
                </div>

                <div class="mt-3">
                    <h6>üîç –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON</h6>
                    <div id="preview-json" class="preview-box" style="max-height: 600px; font-size: 0.75rem;"></div>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
        <div class="card mb-4" id="table-section" style="display: none;">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">üìä –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="records-table">
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>case_id</th>
                                <th>dispute_summary</th>
                                <th>plaintiff</th>
                                <th>defendant</th>
                                <th>decision_verdict</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="records-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Å–ø–æ—Ä—Ç -->
        <div class="card mb-4" id="export-section" style="display: none;">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞—Ç–∞—Å–µ—Ç–∞</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <button id="btn-download-jsonl" class="btn btn-outline-primary me-2">üì• –°–∫–∞—á–∞—Ç—å JSONL</button>
                        <button id="btn-download-json" class="btn btn-outline-primary">üì• –°–∫–∞—á–∞—Ç—å JSON</button>
                    </div>
                    <div class="col-md-6 text-end">
                        <button id="btn-clear-dataset" class="btn btn-outline-danger">üóë –û—á–∏—Å—Ç–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç</button>
                    </div>
                </div>
                <p class="text-muted mt-2 small">
                    ‚ÑπÔ∏è –§–∞–π–ª—ã —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π "_edited" –∫ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞. –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
                </p>
            </div>
        </div>
    </div>

    <!-- ‚úÖ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –°–ö–†–ò–ü–¢–û–í –î–õ–Ø GITHUB PAGES -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        // üîß –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –ø—É—Ç–∏ –¥–ª—è GitHub Pages
        (function() {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å: /datasetbuilder-teplo/enriched-dataset-editor/
            const path = window.location.pathname;
        
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            let basePath = '';
        
            if (path.includes('/enriched-dataset-editor/')) {
                // –ï—Å–ª–∏ –º—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                basePath = path.split('/enriched-dataset-editor/')[0] + '/enriched-dataset-editor/';
            } else {
                // fallback: –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
                basePath = './';
            }
        
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
            window.EDITOR_BASE_PATH = basePath;
        
            console.log('üìÅ Base path –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:', basePath);
        })();
    
        // üîß –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
        function loadScript(relativePath, callback, retryCount = 0) {
            const script = document.createElement('script');
        
            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–ª—è GitHub Pages
            const fullPath = window.EDITOR_BASE_PATH + relativePath;
            script.src = fullPath;
            script.async = false; // –í–∞–∂–Ω–æ: –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
        
            script.onload = function() {
                console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω:', relativePath);
                if (callback) callback();
            };
        
            script.onerror = function() {
                console.warn(`‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω: ${relativePath} (–ø–æ –ø—É—Ç–∏ ${fullPath})`);
            
                // üîÅ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç—ë–º –∫–∞–∫ fallback
                if (retryCount === 0) {
                    console.log('üîÑ –ü—Ä–æ–±—É–µ–º fallback —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç—ë–º...');
                    script.src = './' + relativePath;
                    retryCount = 1;
                } else {
                    console.error(`üö´ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${relativePath}`);
                    if (relativePath.includes('jsonl-handler')) {
                        document.body.innerHTML = `
                            <div style="padding:2rem;text-align:center;color:#dc3545;font-family:sans-serif">
                                <h2>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h2>
                                <p>–§–∞–π–ª <code>js/jsonl-handler.js</code> –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>
                                <p><strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong></p>
                                <ul style="text-align:left;max-width:500px;margin:1rem auto">
                                    <li>–§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</li>
                                    <li>–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –Ω–∞ GitHub</li>
                                    <li>GitHub Pages –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è (–ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω)</li>
                                </ul>
                                <p><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL:</strong><br>
                                <code style="background:#f8f9fa;padding:0.25rem 0.5rem;border-radius:3px">
                                    ${window.location.origin}${window.EDITOR_BASE_PATH}js/jsonl-handler.js
                                </code></p>
                                <a href="../index.html" style="display:inline-block;margin-top:1rem;padding:0.5rem 1rem;background:#0d6efd;color:white;text-decoration:none;border-radius:0.375rem">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–±–æ—Ä—â–∏–∫</a>
                            </div>
                        `;
                    }
                }
            };
        
            document.head.appendChild(script);
        }
    
        // üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û (–≤–∞–∂–Ω–æ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
        document.addEventListener('DOMContentLoaded', function() {
            loadScript('js/jsonl-handler.js', function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ JSONLHandler –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω
                if (typeof JSONLHandler === 'undefined') {
                    console.error('‚ùå JSONLHandler –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞!');
                    return;
                }
                // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º app.js
                loadScript('js/app.js', function() {
                    console.log('‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è)
                    if (typeof init === 'function') {
                        init();
                    }
                });
            });
        });
    </script>
</body>
</html>
